import{s as ue}from"./pinia-C2udNGLe.js";import{u as de}from"./index-mMw67EmN.js";import{a as K}from"./axios-upsvKRUO.js";import{d as ce,r as n,w as me,f as x,i as e,I as pe,O as r,K as m,P as I,R as j,J as S,G as u,H as ve,e as a,Y as P,F as p,N as U,E as M,M as W,g as ge}from"./@vue-Cz6t6s_V.js";import"./leaflet-CA-SS5n8.js";/* empty css                   */import"./vue3-tour-D-BJYS3I.js";import"./@primevue-B6LoD542.js";import"./@primeuix-CZYCaOtW.js";import"./@fortawesome-s9-St5EI.js";import"./sweetalert2-BkU8I-GU.js";import"./@vue-leaflet-ClsXBK7e.js";import"./vue-router-DowOy2fH.js";import"./primevue-sCUDBQs6.js";const fe="/oakhw/highlight1.png",xe="/oakhw/highlight2.png",_e="/oakhw/highlight3.png",be="/oakhw/highlight4.png",ye="/oakhw/highlight5.png";class q{static async GetUrbanUpdatePolygon(){return(await K.get("https://enterprise.oakmega.ai/api/v1/server/xinbei/geolocation-json?directory=tucheng.json")).data}static async GetSurroundingStops(g,F){return(await K.post("https://enterprise.oakmega.ai/api/v1/server/xinbei/calc-distance",{lat:F,lng:g})).data}}const he={class:"mb-3 flex justify-center items-center"},we={key:0,class:"flex justify-center items-center w-full h-full"},ke={key:1,class:"grid grid-cols-1 xl:grid-cols-2 gap-4"},Le={id:"v-step-3",class:"w-full min-h-96 z-0 relative bg-zinc-50 border-2 border-zinc-100 p-3 rounded-2xl"},Se={class:"p-0.5 flex flex-col justify-center w-full divide-y divide-gray-300"},Pe={class:"font-semibold text-lg text-blue-500"},De={class:"font-semibold mt-1"},Ce={class:"p-0.5 flex flex-col justify-center w-full divide-y divide-gray-300"},Ne={class:"font-semibold text-lg text-blue-500"},Ie={class:"font-semibold mt-1"},Me={class:"font-semibold text-red-500"},Fe={class:"font-semibold"},ze={class:"p-0.5 flex flex-col justify-center w-full divide-y divide-gray-300"},Te={class:"font-semibold text-lg text-blue-500"},Ge={class:"font-semibold mt-1"},je={class:"font-semibold text-red-500"},Ue={class:"font-semibold"},Be={id:"v-step-4",class:"mt-4 lg:mt-0 bg-zinc-50 border-2 border-zinc-100 p-3 sm:p-6 rounded-2xl"},Ee={class:"mt-4 grid grid-cols-1 xl:grid-cols-2 gap-4"},Ve=["onClick"],$e={class:"font-semibold text-lg 2xl:text-xl xl:self-start"},Oe={class:"text-blue-800 font-semibold xl:self-end text-lg 2xl:text-xl"},Re={class:"flex w-full items-center justify-between"},w=8,at=ce({__name:"HomeView",setup(J){const g=ge(),F=de(),{User:y}=ue(F),z=n(!1),Y=n(),B=n(15),f=n({lat:0,lng:0}),_=n(""),D=n([]),k=n(f.value),v=n([]),b=n([]),h=n([]),i=n({}),E=n(0),V=n(5),C=n(!1),Z=n({labels:{buttonSkip:"略過",buttonPrevious:"上一個",buttonNext:"下一個",buttonStop:"完成"}}),A=n([{target:"#v-step-0",content:"歡迎使用新北市都市更新Demo!",params:{placement:"left"}},{target:"#v-step-1",content:"點選此處可查看Demo亮點",params:{placement:"right"}},{target:"#v-step-2",content:"點選頭像可查看帳號資訊",params:{placement:"bottom"}},{target:"#v-step-3",content:"點選地圖空白處可移動參考點",params:{placement:"top"}},{target:"#v-step-4",content:"點選下列站點可將地圖中心移至所選站點",params:{placement:"top"}}]);let d={};const Q=(s,t)=>{f.value={lat:s,lng:t},window.scrollTo({top:0,behavior:"smooth"})},T=s=>{if(s.IsEmpty)return;if(Q(s.Latitude,s.Longitude),i.value.Name){const c=v.value.find(o=>o.Name===i.value.Name);c&&(c.IsFocus=!1)}const t=v.value.find(c=>c.Name===s.Name);t&&(t.IsFocus=!0,i.value=t)},$=async(s,t)=>{const c=await q.GetSurroundingStops(s,t);d={},c.result.forEach(o=>{d[o.stop_name]?d[o.stop_name].Distance>o.distance&&(d[o.stop_name].Distance=o.distance,d[o.stop_name].Latitude=o.latitude,d[o.stop_name].Longitude=o.longitude):d[o.stop_name]={Name:o.stop_name,Latitude:o.latitude,Longitude:o.longitude,Distance:o.distance}}),v.value=Object.keys(d).map(o=>({Name:o,Latitude:d[o].Latitude,Longitude:d[o].Longitude,Distance:d[o].Distance,IsFocus:!1})).sort((o,L)=>o.Distance-L.Distance),h.value=v.value,b.value=v.value.slice(0,w)};(()=>{z.value=!0,window.innerWidth<600&&(V.value=3),q.GetUrbanUpdatePolygon().then(s=>{s.result.features.forEach(t=>{D.value.push(t.geometry.coordinates[0].map(([c,o])=>[o,c]))}),f.value={lat:D.value[0][0][0],lng:D.value[0][0][1]},k.value=f.value}).then(()=>$(f.value.lng,f.value.lat)).then(()=>{g&&g.proxy&&g.proxy.$tours&&g.proxy.$tours.myTour&&window.innerWidth>=1280&&g.proxy.$tours.myTour.start(),z.value=!1})})();const O=()=>{for(;b.value.length<w&&window.innerWidth>=1280;)b.value.push({Name:"Empty",Latitude:0,Longitude:0,Distance:0,IsFocus:!1,IsEmpty:!0})},X=s=>{_.value="",i.value={},k.value=s.latlng,$(s.latlng.lng,s.latlng.lat),E.value+=1},ee=s=>{b.value=v.value.slice(s.first,s.first+w),O()},R=()=>{_.value&&(h.value=v.value.filter(s=>s.Name.includes(_.value)),b.value=h.value.slice(0,w),O())};return me(()=>_.value,()=>{if(!_.value){h.value=v.value,b.value=h.value.slice(0,w);return}R()}),(s,t)=>{const c=u("LTileLayer"),o=u("LPolygon"),L=u("LTooltip"),H=u("LIcon"),G=u("LMarker"),te=u("LMap"),le=u("PrimeInputText"),oe=u("PrimeButton"),se=u("PrimeInputGroup"),ne=u("PrimePaginator"),ae=u("PrimeDialog"),ie=u("v-tour"),re=ve("tooltip");return a(),x(I,null,[e("div",he,[t[7]||(t[7]=e("div",{id:"v-step-0",class:"text-3xl md:text-4xl font-semibold text-center text-blue-800"},"新北市都市更新Demo",-1)),pe(e("i",{id:"v-step-1",class:"pi pi-question-circle !text-xl mx-1",onClick:t[0]||(t[0]=l=>C.value=!0)},null,512),[[re,"亮點"]])]),t[15]||(t[15]=e("hr",{class:"mb-5 max-w-72 mx-auto border-blue-100"},null,-1)),z.value?(a(),x("div",we,t[8]||(t[8]=[e("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1)]))):(a(),x("div",ke,[e("div",Le,[r(te,{ref_key:"Map",ref:Y,zoom:B.value,"onUpdate:zoom":t[2]||(t[2]=l=>B.value=l),center:f.value,"onUpdate:center":t[3]||(t[3]=l=>f.value=l),useGlobalLeaflet:!1,onClick:X},{default:m(()=>[r(c,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","layer-type":"base",name:"OpenStreetMap"}),(a(!0),x(I,null,j(D.value,(l,N)=>(a(),S(o,{key:N,"lat-lngs":l,color:"blue",weight:1},null,8,["lat-lngs"]))),128)),P(y).FBName&&P(y).GoogleName?(a(),S(G,{key:0,"lat-lng":k.value},{default:m(()=>[r(L,null,{default:m(()=>[e("div",Se,[e("div",Pe,p(P(y).FBName),1),e("div",null,[e("div",De," 所在位置: "+p([Math.round(k.value.lat*1e3)/1e3,Math.round(k.value.lng*1e3)/1e3]),1)])])]),_:1}),r(H,{"class-name":"rounded-full border-2 border-yellow-600","icon-url":P(y).FBPicture,"icon-size":[50,50],"icon-anchor":[20,40]},null,8,["icon-url"])]),_:1},8,["lat-lng"])):U("",!0),i.value.Name?(a(),S(G,{key:1,"lat-lng":[i.value.Latitude,i.value.Longitude],onClick:t[1]||(t[1]=l=>T(i.value))},{default:m(()=>[r(L,null,{default:m(()=>[e("div",Ce,[e("div",Ne,p(i.value.Name),1),e("div",null,[e("div",Ie,[t[9]||(t[9]=M(" 距離: ")),e("span",Me,p(i.value.Distance.toFixed(1)),1),t[10]||(t[10]=M(" km "))]),e("div",Fe," 所在位置: "+p([Math.round(i.value.Latitude*1e3)/1e3,Math.round(i.value.Longitude*1e3)/1e3]),1)])])]),_:1}),r(H,{"class-name":"rounded-full border-2 border-rose-600","icon-url":P(y).GooglePicture,"icon-size":[40,40],"icon-anchor":[20,40]},null,8,["icon-url"])]),_:1},8,["lat-lng"])):U("",!0),(a(!0),x(I,null,j(v.value,l=>(a(),x("div",{key:l.Name},[l.IsFocus?U("",!0):(a(),S(G,{key:0,"lat-lng":[l.Latitude,l.Longitude],onClick:N=>T(l)},{default:m(()=>[r(L,null,{default:m(()=>[e("div",ze,[e("div",Te,p(l.Name),1),e("div",null,[e("div",Ge,[t[11]||(t[11]=M(" 距離: ")),e("span",je,p(l.Distance.toFixed(1)),1),t[12]||(t[12]=M(" km "))]),e("div",Ue," 所在位置: "+p([Math.round(l.Latitude*1e3)/1e3,Math.round(l.Longitude*1e3)/1e3]),1)])])]),_:2},1024)]),_:2},1032,["lat-lng","onClick"]))]))),128))]),_:1},8,["zoom","center"])]),e("div",Be,[r(se,null,{default:m(()=>[r(le,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=l=>_.value=l),placeholder:"搜尋附近站點",pt:{root:{class:"!p-3 !text-xl"}}},null,8,["modelValue"]),r(oe,{icon:"pi pi-search",severity:"contrast",pt:{root:{class:"!px-6"},icon:{class:"!text-xl"}},onClick:R})]),_:1}),e("div",Ee,[(a(!0),x(I,null,j(b.value,(l,N)=>(a(),x("div",{key:N,class:W([l.IsFocus?"bg-cyan-50 border-cyan-200 hover:bg-cyan-100 hover:border-cyan-300":"bg-blue-50 border-blue-200 hover:bg-sky-100 hover:border-sky-300","border-2 cursor-pointer p-3 sm:p-6 xl:p-3 rounded-lg sm:rounded-xl shadow-md"]),onClick:Ke=>T(l)},[e("div",{class:W([l.IsEmpty?"opacity-0":"","flex xl:flex-col items-center justify-between"])},[e("div",$e,p(l.Name),1),e("div",Oe,p(l.Distance.toFixed(1))+" 公里",1)],2)],10,Ve))),128))]),(a(),S(ne,{class:"mt-3",key:E.value,totalRecords:h.value.length,rows:w,pageLinkSize:V.value,pt:{root:{class:"!bg-zinc-50"},current:{class:"!text-blue-500"}},onPage:ee},null,8,["totalRecords","pageLinkSize"]))])])),r(ae,{visible:C.value,"onUpdate:visible":t[6]||(t[6]=l=>C.value=l),modal:"",class:"w-10/12",draggable:!1,closable:!1},{header:m(()=>[e("div",Re,[t[13]||(t[13]=e("div",{class:"text-2xl font-semibold"},"亮點 ✨",-1)),e("i",{class:"pi pi-times !text-lg cursor-pointer",onClick:t[5]||(t[5]=l=>C.value=!1)})])]),default:m(()=>[t[14]||(t[14]=e("div",{class:"flex flex-col items-center gap-5 p-4 divide-y divide-dashed divide-gray-300"},[e("div",{class:"w-full"},[e("div",{class:"text-xl font-semibold"},"1. 進入網頁時會進行網頁導覽"),e("img",{src:fe,alt:"網頁導覽",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"2. 點選頂欄頭像可查看 Google 與 Facebook 的登入資訊"),e("img",{src:xe,alt:"登入資訊",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"3. 點選地圖空白處可移動參考點(Facebook的頭像)"),e("img",{src:_e,alt:"移動參考點",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"4. 點選右側站點可移動地圖中心至所選站點，並將站點更改為Google的頭像"),e("img",{src:be,alt:"移動至站點",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"5. 可用關鍵字搜尋站點"),e("img",{src:ye,alt:"搜尋站點",class:"w-full"})])],-1))]),_:1},8,["visible"]),r(ie,{name:"myTour",steps:A.value,options:Z.value},null,8,["steps","options"])],64)}}});export{at as default};
