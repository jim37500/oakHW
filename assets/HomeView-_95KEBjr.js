import{s as ne}from"./pinia-CsvwGg5R.js";import{u as ae}from"./index-DKqYyDlr.js";import{a as H}from"./axios-upsvKRUO.js";import{d as ie,r as n,w as re,f,i as e,I as ue,O as u,K as m,P as F,R as j,J as k,G as d,H as de,e as a,Y as P,F as v,N as U,E as I,M as K}from"./@vue-Dgw5popM.js";import"./leaflet-CA-SS5n8.js";/* empty css                   */import"./@primevue-DsDnal0c.js";import"./@primeuix-CZYCaOtW.js";import"./@fortawesome-DPfb-5vm.js";import"./@vue-leaflet-DmIZX8Tx.js";import"./vue-router-NsaB4nCB.js";import"./primevue-CEBTUVJt.js";const ce="/oakhw/highlight2.png",me="/oakhw/highlight3.png",ve="/oakhw/highlight4.png",pe="/oakhw/highlight5.png";class W{static async GetUrbanUpdatePolygon(){return(await H.get("https://enterprise.oakmega.ai/api/v1/server/xinbei/geolocation-json?directory=tucheng.json")).data}static async GetSurroundingStops(S,x){return(await H.post("https://enterprise.oakmega.ai/api/v1/server/xinbei/calc-distance",{lat:x,lng:S})).data}}const ge={class:"mb-3 flex justify-center items-center"},fe={key:0,class:"flex justify-center items-center w-full h-full"},xe={key:1,class:"grid grid-cols-1 xl:grid-cols-2 gap-4"},_e={class:"w-full min-h-96 z-0 relative bg-zinc-50 border-2 border-zinc-100 p-3 rounded-2xl"},be={class:"p-0.5 flex flex-col justify-center w-full divide-y divide-gray-300"},ye={class:"font-semibold text-lg text-blue-500"},he={class:"font-semibold mt-1"},we={class:"p-0.5 flex flex-col justify-center w-full divide-y divide-gray-300"},Le={class:"font-semibold text-lg text-blue-500"},ke={class:"font-semibold mt-1"},Pe={class:"font-semibold text-red-500"},Se={class:"font-semibold"},De={class:"p-0.5 flex flex-col justify-center w-full divide-y divide-gray-300"},Ce={class:"font-semibold text-lg text-blue-500"},Me={class:"font-semibold mt-1"},Ne={class:"font-semibold text-red-500"},Fe={class:"font-semibold"},Ie={class:"mt-4 lg:mt-0 bg-zinc-50 border-2 border-zinc-100 p-3 sm:p-6 rounded-2xl"},ze={class:"mt-4 grid grid-cols-1 xl:grid-cols-2 gap-4"},Ge=["onClick"],je={class:"font-semibold text-lg 2xl:text-xl xl:self-start"},Ue={class:"text-blue-800 font-semibold xl:self-end text-lg 2xl:text-xl"},Be={class:"flex w-full items-center justify-between"},h=8,Qe=ie({__name:"HomeView",setup(q){const S=ae(),{User:x}=ne(S),D=n(!1),J=n(),B=n(15),g=n({lat:0,lng:0}),_=n(""),C=n([]),w=n(g.value),p=n([]),b=n([]),y=n([]),i=n({}),T=n(0),E=n(5),M=n(!1);let r={};const Y=(s,t)=>{g.value={lat:s,lng:t},window.scrollTo({top:0,behavior:"smooth"})},z=s=>{if(s.IsEmpty)return;if(Y(s.Latitude,s.Longitude),i.value.Name){const c=p.value.find(o=>o.Name===i.value.Name);c&&(c.IsFocus=!1)}const t=p.value.find(c=>c.Name===s.Name);t&&(t.IsFocus=!0,i.value=t)},V=async(s,t)=>{const c=await W.GetSurroundingStops(s,t);r={},c.result.forEach(o=>{r[o.stop_name]?r[o.stop_name].Distance>o.distance&&(r[o.stop_name].Distance=o.distance,r[o.stop_name].Latitude=o.latitude,r[o.stop_name].Longitude=o.longitude):r[o.stop_name]={Name:o.stop_name,Latitude:o.latitude,Longitude:o.longitude,Distance:o.distance}}),p.value=Object.keys(r).map(o=>({Name:o,Latitude:r[o].Latitude,Longitude:r[o].Longitude,Distance:r[o].Distance,IsFocus:!1})).sort((o,L)=>o.Distance-L.Distance),y.value=p.value,b.value=p.value.slice(0,h)};(()=>{D.value=!0,window.innerWidth<600&&(E.value=3),W.GetUrbanUpdatePolygon().then(s=>{s.result.features.forEach(t=>{C.value.push(t.geometry.coordinates[0].map(([c,o])=>[o,c]))}),g.value={lat:C.value[0][0][0],lng:C.value[0][0][1]},w.value=g.value}).then(()=>V(g.value.lng,g.value.lat)).then(()=>{D.value=!1})})();const $=()=>{for(;b.value.length<h&&window.innerWidth>=1280;)b.value.push({Name:"Empty",Latitude:0,Longitude:0,Distance:0,IsFocus:!1,IsEmpty:!0})},Z=s=>{_.value="",i.value={},w.value=s.latlng,V(s.latlng.lng,s.latlng.lat),T.value+=1},A=s=>{b.value=p.value.slice(s.first,s.first+h),$()},O=()=>{_.value&&(y.value=p.value.filter(s=>s.Name.includes(_.value)),b.value=y.value.slice(0,h),$())};return re(()=>_.value,()=>{if(!_.value){y.value=p.value,b.value=y.value.slice(0,h);return}O()}),(s,t)=>{const c=d("LTileLayer"),o=d("LPolygon"),L=d("LTooltip"),R=d("LIcon"),G=d("LMarker"),Q=d("LMap"),X=d("PrimeInputText"),ee=d("PrimeButton"),te=d("PrimeInputGroup"),le=d("PrimePaginator"),oe=d("PrimeDialog"),se=de("tooltip");return a(),f(F,null,[e("div",ge,[t[7]||(t[7]=e("div",{class:"text-3xl md:text-4xl font-semibold text-center text-blue-800"},"新北市都市更新Demo",-1)),ue(e("i",{class:"pi pi-question-circle !text-xl mx-1",onClick:t[0]||(t[0]=l=>M.value=!0)},null,512),[[se,"亮點"]])]),t[15]||(t[15]=e("hr",{class:"mb-5 max-w-72 mx-auto border-blue-100"},null,-1)),D.value?(a(),f("div",fe,t[8]||(t[8]=[e("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1)]))):(a(),f("div",xe,[e("div",_e,[u(Q,{ref_key:"Map",ref:J,zoom:B.value,"onUpdate:zoom":t[2]||(t[2]=l=>B.value=l),center:g.value,"onUpdate:center":t[3]||(t[3]=l=>g.value=l),useGlobalLeaflet:!1,onClick:Z},{default:m(()=>[u(c,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","layer-type":"base",name:"OpenStreetMap"}),(a(!0),f(F,null,j(C.value,(l,N)=>(a(),k(o,{key:N,"lat-lngs":l,color:"blue",weight:1},null,8,["lat-lngs"]))),128)),P(x).FBName&&P(x).GoogleName?(a(),k(G,{key:0,"lat-lng":w.value},{default:m(()=>[u(L,null,{default:m(()=>[e("div",be,[e("div",ye,v(P(x).FBName),1),e("div",null,[e("div",he," 所在位置: "+v([Math.round(w.value.lat*1e3)/1e3,Math.round(w.value.lng*1e3)/1e3]),1)])])]),_:1}),u(R,{"class-name":"rounded-full border-2 border-yellow-600","icon-url":P(x).FBPicture,"icon-size":[50,50],"icon-anchor":[20,40]},null,8,["icon-url"])]),_:1},8,["lat-lng"])):U("",!0),i.value.Name?(a(),k(G,{key:1,"lat-lng":[i.value.Latitude,i.value.Longitude],onClick:t[1]||(t[1]=l=>z(i.value))},{default:m(()=>[u(L,null,{default:m(()=>[e("div",we,[e("div",Le,v(i.value.Name),1),e("div",null,[e("div",ke,[t[9]||(t[9]=I(" 距離: ")),e("span",Pe,v(i.value.Distance.toFixed(1)),1),t[10]||(t[10]=I(" km "))]),e("div",Se," 所在位置: "+v([Math.round(i.value.Latitude*1e3)/1e3,Math.round(i.value.Longitude*1e3)/1e3]),1)])])]),_:1}),u(R,{"class-name":"rounded-full border-2 border-rose-600","icon-url":P(x).GooglePicture,"icon-size":[40,40],"icon-anchor":[20,40]},null,8,["icon-url"])]),_:1},8,["lat-lng"])):U("",!0),(a(!0),f(F,null,j(p.value,l=>(a(),f("div",{key:l.Name},[l.IsFocus?U("",!0):(a(),k(G,{key:0,"lat-lng":[l.Latitude,l.Longitude],onClick:N=>z(l)},{default:m(()=>[u(L,null,{default:m(()=>[e("div",De,[e("div",Ce,v(l.Name),1),e("div",null,[e("div",Me,[t[11]||(t[11]=I(" 距離: ")),e("span",Ne,v(l.Distance.toFixed(1)),1),t[12]||(t[12]=I(" km "))]),e("div",Fe," 所在位置: "+v([Math.round(l.Latitude*1e3)/1e3,Math.round(l.Longitude*1e3)/1e3]),1)])])]),_:2},1024)]),_:2},1032,["lat-lng","onClick"]))]))),128))]),_:1},8,["zoom","center"])]),e("div",Ie,[u(te,null,{default:m(()=>[u(X,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=l=>_.value=l),placeholder:"搜尋附近站點",pt:{root:{class:"!p-3 !text-xl"}}},null,8,["modelValue"]),u(ee,{icon:"pi pi-search",severity:"contrast",pt:{root:{class:"!px-6"},icon:{class:"!text-xl"}},onClick:O})]),_:1}),e("div",ze,[(a(!0),f(F,null,j(b.value,(l,N)=>(a(),f("div",{key:N,class:K([l.IsFocus?"bg-cyan-50 border-cyan-200 hover:bg-cyan-100 hover:border-cyan-300":"bg-blue-50 border-blue-200 hover:bg-sky-100 hover:border-sky-300","border-2 cursor-pointer p-3 sm:p-6 xl:p-3 rounded-lg sm:rounded-xl shadow-md"]),onClick:Ee=>z(l)},[e("div",{class:K([l.IsEmpty?"opacity-0":"","flex xl:flex-col items-center justify-between"])},[e("div",je,v(l.Name),1),e("div",Ue,v(l.Distance.toFixed(1))+" 公里",1)],2)],10,Ge))),128))]),(a(),k(le,{class:"mt-3",key:T.value,totalRecords:y.value.length,rows:h,pageLinkSize:E.value,pt:{root:{class:"!bg-zinc-50"},current:{class:"!text-blue-500"}},onPage:A},null,8,["totalRecords","pageLinkSize"]))])])),u(oe,{visible:M.value,"onUpdate:visible":t[6]||(t[6]=l=>M.value=l),modal:"",class:"w-10/12",draggable:!1,closable:!1},{header:m(()=>[e("div",Be,[t[13]||(t[13]=e("div",{class:"text-2xl font-semibold"},"亮點 ✨",-1)),e("i",{class:"pi pi-times !text-lg cursor-pointer",onClick:t[5]||(t[5]=l=>M.value=!1)})])]),default:m(()=>[t[14]||(t[14]=e("div",{class:"flex flex-col items-center gap-5 p-4 divide-y divide-dashed divide-gray-300"},[e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"1. 點選頂欄頭像可查看 Google 與 Facebook 的登入資訊"),e("img",{src:ce,alt:"登入資訊",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"2. 點選地圖空白處可移動參考點(Facebook的頭像)"),e("img",{src:me,alt:"移動參考點",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"3. 點選右側站點可移動地圖中心至所選站點，並將站點更改為Google的頭像"),e("img",{src:ve,alt:"移動至站點",class:"w-full"})]),e("div",{class:"w-full"},[e("div",{class:"text-xl mt-3 font-semibold"},"4. 可用關鍵字搜尋站點"),e("img",{src:pe,alt:"搜尋站點",class:"w-full"})])],-1))]),_:1},8,["visible"])],64)}}});export{Qe as default};
